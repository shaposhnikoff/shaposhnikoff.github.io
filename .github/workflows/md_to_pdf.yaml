name: Update CV from MD to PDF

on:
  push:
    branches: [ "*" ]
  pull_request:
    branches: [ "*" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Checkout Code
        uses: actions/checkout@v3

      # 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: pandoc, LaTeX, –∏ emoji-—à—Ä–∏—Ñ—Ç—ã
      - name: Install Dependencies (Pandoc, LaTeX, Emoji Fonts)
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc \
            texlive-xetex \
            texlive-fonts-recommended \
            texlive-latex-base \
            texlive-latex-extra \
            fonts-noto \
            fonts-noto-color-emoji

      # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π emoji
      - name: Generate PDF from Markdown
        run: |
          pandoc index.md -o index.pdf \
            --pdf-engine=xelatex \
            --highlight-style=tango \
            -V geometry:margin=1in \
            -V mainfont="Noto Sans" \
            -V monofont="Noto Sans Mono"

      # 4. –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ PDF
      - name: Upload PDF Artifact
        uses: actions/upload-artifact@v4
        with:
          name: CV-PDF
          path: index.pdf

      # 5. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π PDF –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Commit Generated PDF
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "shaposhnikoff"
          git config user.email "max@shaposhnikoff.info"
          git add index.pdf
          git diff --cached --quiet || git commit -m "Update generated CV PDF"
          git push

      # 6. –û—Ç–ø—Ä–∞–≤–∫–∞ PDF –≤ Telegram –∫–∞–∫ —Ñ–∞–π–ª
      - name: Send PDF to Telegram
        if: success()
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          curl -s -X POST https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendDocument \
            -F chat_id="$TELEGRAM_CHAT_ID" \
            -F document=@index.pdf \
            -F caption="üìÑ *CV PDF –æ–±–Ω–æ–≤–ª—ë–Ω!* –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω." \
            -F parse_mode=Markdown
