name: Update CV from MD to PDF 

on:
  schedule:
      - cron: '0 22 * * *'
  push:
    branches: 
      - '*' 
  pull_request:
    branches:
      - '*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Setup Python Environment
        uses: actions/setup-python@v2
        with:
          python-version: 3.7
          
      - name: 'Get pandoc'
        run:  sudo apt-get install pandoc
    
      - name: 'Convert index.md to index.html with pandoc'
        run:  pandoc index.md > index.html

      - uses: actions/checkout@v2
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-latex-base texlive-fonts-recommended texlive-fonts-extra texlive-latex-extra

      - name: Convert Markdown to PDF
        run: pandoc index.md -o index.pdf

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v2
        with:
          name: index
          path: index.pdf
        

#      - name: html to pdf
#        uses: fifsky/html-to-pdf-action@master
#        with:
#          htmlFile: index.html
#          outputFile: shaposhnikov_cv.pdf
#         pdfOptions: '{"format": "A4", "margin": {"top": "10mm", "left": "10mm", "right": "10mm", "bottom": "10mm"}}'

      - name: html2pdf2	
        uses: markwilson/html2pdf@v1.0
        with:
          htmlPath: 'index.html'
          pdfName: 'cv'

      - name: setup git config
        run: |
          git config user.name shaposhnikoff
          git config user.email max@shaposhnikoff.info
          git add .
          
      - name: commit changes
        run: |
          chmod +x ./commit.sh
          ./commit.sh
          
